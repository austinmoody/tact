services:
  api:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "2100:2100"
    volumes:
      - ./data:/app/data
    environment:
      - PYTHONUNBUFFERED=1
      - TACT_DB_PATH=/app/data/tact.db
      - TACT_LLM_PROVIDER=ollama
      - TACT_OLLAMA_URL=http://ollama:11434
      - TACT_OLLAMA_TIMEOUT=180 # seconds, increase if parsing times out
      - TACT_OLLAMA_MODEL=phi3:mini
      - TACT_DURATION_ROUNDING=15 # Round up to 15 or 30 minutes (default: none)

  ollama:
    image: ollama/ollama
    ports:
      - "11434:11434"
    volumes:
      - ollama_data:/root/.ollama

  mcp:
    build:
      context: ./mcp
      dockerfile: Dockerfile
    profiles:
      - tools
    environment:
      - TACT_API_URL=http://api:2100
    depends_on:
      - api

volumes:
  ollama_data:
